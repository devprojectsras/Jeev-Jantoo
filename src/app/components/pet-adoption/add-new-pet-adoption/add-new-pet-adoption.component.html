<form [formGroup]="petAdoptionForm" (ngSubmit)="onSubmit()" class="card m-4 align-content-md-start">
  <div class="card-body">
    <div class="d-md-flex align-items-center justify-content-between mb-3">
      <div class="text-center text-md-start mb-2 mb-md-0">
        <h4>New Pet Adoption</h4>
      </div>
      <button type="button" class="btn col-md-3 col-12 btn-outline-primary" 
              [routerLink]="['/manage-pet-adoption']">Manage Pet Adoptions</button>
    </div>

    <div class="row g-2">
      <!-- Pet Name -->
      <div class="form-floating col-md-6 col-12 mb-3">
        <input type="text" class="form-control" id="petName" formControlName="petName" placeholder="Buddy" required>
        <label for="petName">Pet Name <span class="text-danger">*</span></label>
        <div *ngIf="petAdoptionForm.get('petName')?.touched && petAdoptionForm.get('petName')?.invalid" class="text-danger">
          Pet Name is required.
        </div>
      </div>

      <!-- Species (codes) -->
      <div class="form-floating col-md-6 col-12 mb-3">
        <select class="form-select" id="species" formControlName="species" required>
          <option value="" disabled>Select a species</option>
          <option value="dog">Dog</option>
          <option value="cat">Cat</option>
          <option value="bird">Bird</option>
          <option value="fish">Fish</option>
          <option value="rabbit">Rabbit</option>
          <option value="other">Other</option>
        </select>
        <label for="species">Species <span class="text-danger">*</span></label>
        <div *ngIf="petAdoptionForm.get('species')?.touched && petAdoptionForm.get('species')?.invalid" class="text-danger">
          Species is required.
        </div>
      </div>

      <!-- Breed -->
      <div class="form-floating col-md-6 col-12 mb-3">
        <input type="text" class="form-control" id="breed" formControlName="breed" placeholder="Labrador" required>
        <label for="breed">Breed <span class="text-danger">*</span></label>
        <div *ngIf="petAdoptionForm.get('breed')?.touched && petAdoptionForm.get('breed')?.invalid" class="text-danger">
          Breed is required.
        </div>
      </div>

      <!-- Age (Years + Months) -->
      <div class="col-md-6 col-12 mb-3">
        <div class="row g-2">
          <div class="form-floating col-6">
            <input type="number" class="form-control" id="ageYears" formControlName="ageYears" min="0" placeholder="0">
            <label for="ageYears">Age (Years)</label>
          </div>
          <div class="form-floating col-6">
            <input type="number" class="form-control" id="ageMonths" formControlName="ageMonths" min="0" max="11" placeholder="0">
            <label for="ageMonths">Age (Months)</label>
          </div>
        </div>
        <div class="text-danger mt-1" *ngIf="ageTouched() && petAdoptionForm.errors?.['ageRequired']">
          Please enter at least one of Years or Months.
        </div>
        <div class="text-danger mt-1" *ngIf="ageTouched() && petAdoptionForm.errors?.['ageInvalid']">
          Age must be non-negative numbers; months must be 0â€“11.
        </div>
      </div>

      <!-- Gender -->
      <div class="form-floating col-md-6 col-12 mb-3">
        <select class="form-select" id="gender" formControlName="gender" required>
          <option value="" disabled>Select a gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Unknown">Unknown</option>
        </select>
        <label for="gender">Gender <span class="text-danger">*</span></label>
        <div *ngIf="petAdoptionForm.get('gender')?.touched && petAdoptionForm.get('gender')?.invalid" class="text-danger">
          Gender is required.
        </div>
      </div>

      <!-- Health Status -->
      <div class="form-floating col-md-6 col-12 mb-3">
        <select class="form-select" id="healthStatus" formControlName="healthStatus" required>
          <option value="" disabled>Select health status</option>
          <option value="Healthy">Healthy</option>
          <option value="Needs Treatment">Needs Treatment</option>
          <option value="Vaccinated">Vaccinated</option>
        </select>
        <label for="healthStatus">Health Status <span class="text-danger">*</span></label>
        <div *ngIf="petAdoptionForm.get('healthStatus')?.touched && petAdoptionForm.get('healthStatus')?.invalid" class="text-danger">
          Health Status is required.
        </div>
      </div>

      <!-- Contact -->
      <div class="form-floating col-md-6 col-12 mb-3">
        <input type="text" class="form-control" id="contact" formControlName="contact" placeholder="7845129632" required>
        <label for="contact">Contact <span class="text-danger">*</span></label>
        <div *ngIf="petAdoptionForm.get('contact')?.touched && petAdoptionForm.get('contact')?.invalid" class="text-danger">
          Contact is required and must be valid.
        </div>
      </div>

      <!-- Location -->
      <div class="form-floating col-md-6 col-12 mb-3">
        <input type="text" class="form-control" id="location" formControlName="location" placeholder="Bhopal" required>
        <label for="location">Location <span class="text-danger">*</span></label>
        <div *ngIf="petAdoptionForm.get('location')?.touched && petAdoptionForm.get('location')?.invalid" class="text-danger">
          Location is required.
        </div>
      </div>

      <!-- Description -->
      <div class="form-floating col-md-12 col-12 mb-3">
        <textarea class="form-control" id="description" formControlName="description" placeholder="Describe the pet" maxlength="255"></textarea>
        <label for="description">Description</label>
      </div>

      <!-- Photos (Multiple) -->
      <div class="col-md-12 col-12 mb-3">
        <label for="photo" class="form-label">Pet Photos (Optional)</label>
        <input
          type="file"
          class="form-control"
          id="photo"
          (change)="onFileSelected($event)"
          multiple
          accept="image/*"
        />
        <div class="form-text" *ngIf="selectedFiles?.length">{{ selectedFiles.length }} image(s) selected</div>

        <!-- Previews -->
        <div class="d-flex flex-wrap gap-2 mt-2" *ngIf="selectedFiles?.length">
          <div class="position-relative" *ngFor="let f of selectedFiles; let i = index">
            <img [src]="previewFile(f)"
                 alt="preview"
                 class="rounded border"
                 style="width:96px;height:96px;object-fit:cover" />
            <button type="button"
                    class="btn btn-sm btn-secondary position-absolute top-0 end-0 translate-middle badge rounded-pill"
                    aria-label="Remove"
                    (click)="removeNewFile(i)">
              &times;
            </button>
          </div>
        </div>
      </div>

      <!-- Submit -->
      <div class="col-12">
        <button type="submit" class="btn col-md-3 col-12 btn-primary" [disabled]="petAdoptionForm.invalid">
          Submit
        </button>
      </div>
    </div>
  </div>
</form>
